{
  "PreCompact": [
    {
      "matcher": ".*",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "You are about to compact the conversation context, but there is an active MVP planning session with state saved in `.mvp-state.json`.\n\n**DO NOT ALLOW COMPACTION.**\n\nInstead:\n1. Read `.mvp-state.json` to check current planning phase\n2. Save any recent progress to the state file\n3. Return an error message blocking compaction with these instructions:\n\n```\nMVP planning session detected. To prevent losing context:\n\n1. Your progress is saved in .mvp-state.json\n2. Current phase: [show current_phase from state]\n3. Please run /clear or /new to start a fresh session\n4. Then run /mvp-planner:plan again to resume automatically\n\nCompaction blocked to preserve planning context.\n```\n\nThis ensures the user can resume planning in a fresh session without losing progress."
        }
      ]
    }
  ],
  "SubagentStop": [
    {
      "matcher": "mvp-planner.*",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "An MVP planner agent just completed. Update the `.mvp-state.json` file to reflect the agent's completion:\n\n1. Read the `.mvp-state.json` file\n2. Update the `updated_at` timestamp to current time\n3. Ensure the agent that just ran is in `completed_phases` array\n4. Ensure `current_phase` points to the next phase in the workflow:\n   - If discovery-guide completed → current_phase: \"feature-brainstorm\"\n   - If feature-brainstorm completed → current_phase: \"mvp-scoper\"\n   - If mvp-scoper completed → current_phase: \"spec-writer\"\n   - If spec-writer completed → current_phase: \"completed\"\n5. Preserve all other state data\n6. Write the updated state back to `.mvp-state.json`\n\nThis automatic state saving ensures the user can resume at any point if the session is interrupted."
        }
      ]
    }
  ]
}
