{
  "description": "Project tracker hooks for session lifecycle and feature completion detection",
  "hooks": {
    "SessionStart": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a session resumption hook that provides project context at session start.\n\n## Your Task\n\nCheck if project-tracker is being used and provide concise session context.\n\n## Detection\n\n1. Check if ROADMAP.md exists in the current directory\n2. If it exists, look for:\n   - Active story (content under \"## Active\" section)\n   - Progress (count [x] vs [ ] checkboxes in Active section)\n   - Backlog items (content under \"## Backlog\" section)\n\n3. Optionally check .claude/project-tracker.local.md for:\n   - active_story field in frontmatter\n   - last_task field\n\n## Response Format\n\nAlways return approve. Add context only if ROADMAP.md exists:\n\n```json\n{\n  \"decision\": \"approve\",\n  \"hookSpecificOutput\": {\n    \"additionalContext\": \"<context-message>\"\n  }\n}\n```\n\n## Context Message Formats\n\n**If active story exists:**\n\"Session Resume: Working on **{story name}** ({completed}/{total} tasks). Use `/project-tracker:roadmap` to see full status.\"\n\n**If no active story but backlog exists:**\n\"Session Resume: No active story. {N} items in backlog. Use `/project-tracker:roadmap` to start one.\"\n\n**If no ROADMAP.md exists:**\nReturn approve with NO additionalContext (completely silent):\n```json\n{\n  \"decision\": \"approve\"\n}\n```\n\n## Important\n- Keep context message under 200 characters\n- Be completely silent if not using project-tracker (no ROADMAP.md)\n- Never block, always approve",
            "timeout": 10
          }
        ]
      }
    ],
    "SubagentStop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "You are a hook that detects when feature-dev workflow completes and triggers `/project-tracker:roadmap done`.\n\n## Detection Criteria\n\nCheck ALL of these conditions:\n\n1. **Feature-dev Workflow Complete**: Look in the conversation transcript for signs that /feature-dev:feature-dev has completed:\n   - The SlashCommand tool was used to run `/feature-dev:feature-dev` OR the command-message shows \"feature-dev:feature-dev is running\"\n   - Phase 7 (Summary) has been completed - look for \"Phase 7\" or \"Summary\" section with completed todos\n   - All TodoWrite items from the feature-dev workflow are marked \"completed\"\n   - If feature-dev was never run in this conversation, return approve (not a feature-dev workflow)\n\n2. **Active Story Exists**: ROADMAP.md exists AND has content in the \"## Active\" section\n   - If no ROADMAP.md, return approve (not using project-tracker)\n   - If Active section is empty or says \"None\", return approve (no story to mark done)\n\n3. **Implementation Work Occurred**: The conversation transcript shows actual implementation:\n   - Write tool used to create/modify code files\n   - Edit tool used to modify code\n   - NOT just planning, reading, or exploration\n\n4. **Not Already Done**: `/project-tracker:roadmap done` was NOT already run in this session\n\n5. **This is a Subagent Stopping**: The subagent that just stopped should be one of:\n   - feature-dev:code-reviewer (from Phase 6)\n   - Any agent that ran as part of feature-dev workflow\n   - If this is not a feature-dev related subagent, return approve\n\n## Response\n\n**If ALL criteria are met** (feature-dev complete + active story + implementation work + not already done + relevant subagent):\n```json\n{\n  \"decision\": \"block\",\n  \"reason\": \"Feature development workflow complete. Running /project-tracker:roadmap done to mark the story complete.\",\n  \"systemMessage\": \"The /feature-dev:feature-dev workflow has completed Phase 7 (Summary) and all tasks are done. There is an active story in ROADMAP.md. Use the SlashCommand tool to run `/project-tracker:roadmap done` to mark the story as complete and move it to Done.\"\n}\n```\n\n**If ANY criterion is NOT met:**\n```json\n{\n  \"decision\": \"approve\"\n}\n```\n\n## Important Rules\n\n- Be very conservative: only trigger if clearly in feature-dev workflow that completed Phase 7\n- If you can't find clear evidence of /feature-dev:feature-dev running, approve\n- If Phase 7 hasn't completed yet, approve (let other subagents finish)\n- Missing ROADMAP.md = not using project-tracker (approve silently)\n- The /project-tracker:roadmap done command will ask for user confirmation, so it's safe to trigger\n- Check the conversation context to see if this subagent is part of feature-dev workflow",
            "timeout": 30
          }
        ]
      }
    ],
    "SessionEnd": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "bash ${CLAUDE_PLUGIN_ROOT}/scripts/session-end.sh",
            "timeout": 5
          }
        ]
      }
    ]
  }
}
